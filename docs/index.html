<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>dynamodb-batch-iterator</title><meta name="description" content="Documentation for dynamodb-batch-iterator"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">dynamodb-batch-iterator</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>dynamodb-batch-iterator</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#amazon-dynamodb-batch-iteration" id="amazon-dynamodb-batch-iteration" style="color: inherit; text-decoration: none;">
  <h1>Amazon DynamoDB Batch Iteration</h1>
</a>
<p><a href="http://aws.amazon.com/apache-2-0/"><img src="https://img.shields.io/github/license/awslabs/dynamodb-data-mapper-js.svg?style=flat" alt="Apache 2 License"></a></p>
<blockquote>
<p>This is a fork of the <a href="https://github.com/awslabs/dynamodb-data-mapper-js/tree/master/packages/dynamodb-batch-iterator">https://github.com/awslabs/dynamodb-data-mapper-js/tree/master/packages/dynamodb-batch-iterator</a> package to work with aws-sdk v3</p>
</blockquote>
<p>This library provides utilities for automatically submitting arbitrarily-sized batches of reads and writes to DynamoDB using well-formed <code>BatchGetItem</code> and <code>BatchWriteItem</code> operations, respectively. Partial successes (i.e., <code>BatchGetItem</code> operations that return some responses and some unprocessed keys or <code>BatchWriteItem</code> operations that return some unprocessed items) will retry the unprocessed items automatically using exponential backoff.</p>

<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
  <h2>Getting started</h2>
</a>

<a href="#reading-batches-of-items" id="reading-batches-of-items" style="color: inherit; text-decoration: none;">
  <h3>Reading batches of items</h3>
</a>
<p>Create a <code>BatchGet</code> object, supplying an instantiated DynamoDB client from the AWS SDK for JavaScript and an iterable of keys that you wish to retrieve. The iterable may be synchronous (such as an array) or asynchronous (such as an object stream wrapped with <a href="https://github.com/calvinmetcalf/async-iter-stream">async-iter-stream</a>&#39;s <code>wrap</code> method).</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">BatchGet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;dynamodb-batch-iterator&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">DynamoDBClient</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamoDb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({ </span><span class="hl-2">region:</span><span class="hl-1"> </span><span class="hl-3">&#39;us-west-2&#39;</span><span class="hl-1"> });</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">keys</span><span class="hl-1"> = [</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;0&#39;</span><span class="hl-1"> } }],</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;1&#39;</span><span class="hl-1"> } }],</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;2&#39;</span><span class="hl-1"> } }],</span><br/><span class="hl-1">    </span><span class="hl-7">// etc., continuing to count up to</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;1001&#39;</span><span class="hl-1"> } }]</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-0">for</span><span class="hl-1"> </span><span class="hl-0">await</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">item</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">BatchGet</span><span class="hl-1">(</span><span class="hl-2">dynamoDb</span><span class="hl-1">, </span><span class="hl-2">keys</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">item</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>The above code snippet will automatically split the provided keys into <code>BatchGetItem</code> requests of 100 or fewer keys, and any unprocessed keys will be automatically retried until they are handled. The above code will execute at least 11 <code>BatchGetItem</code> operations, dependening on how many items are returned without processing due to insufficient provisioned read capacity.</p>
<p>Each item yielded in the <code>for...await...of</code> loop will be a single DynamoDB record. Iteration will stop once each key has been retrieved or an error has been encountered.</p>

<a href="#writing-batches-of-items" id="writing-batches-of-items" style="color: inherit; text-decoration: none;">
  <h3>Writing batches of items</h3>
</a>
<p>Create a <code>BatchWrite</code> object, supplying an instantiated DynamoDB client from the AWS SDK for JavaScript and an iterable of write requests that you wish to execute. The iterable may be synchronous (such as an array) or asynchronous (such as an object stream wrapped with <a href="https://github.com/calvinmetcalf/async-iter-stream">async-iter-stream</a>&#39;s <code>wrap</code> method).</p>
<p>Each write request should contain either a <code>DeleteRequest</code> key or a <code>PutRequest</code> key as described <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_WriteRequest.html#DDB-Type-WriteRequest-DeleteRequest">in the Amazon DynamoDB API reference</a>.</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">BatchWrite</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws/dynamodb-batch-iterator&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">DynamoDBClient</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamoDb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDB</span><span class="hl-1">({ </span><span class="hl-2">region:</span><span class="hl-1"> </span><span class="hl-3">&#39;us-west-2&#39;</span><span class="hl-1"> });</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">keys</span><span class="hl-1"> = [</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">DeleteRequest:</span><span class="hl-1"> { </span><span class="hl-2">Key:</span><span class="hl-1"> { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;0&#39;</span><span class="hl-1"> } } } }],</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">PutRequest:</span><span class="hl-1"> { </span><span class="hl-2">Item:</span><span class="hl-1"> { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;1&#39;</span><span class="hl-1"> }, </span><span class="hl-2">otherProperty:</span><span class="hl-1"> { </span><span class="hl-2">BOOL:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1"> } } } }],</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">DeleteRequest:</span><span class="hl-1"> { </span><span class="hl-2">Key:</span><span class="hl-1"> { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;2&#39;</span><span class="hl-1"> } } } }],</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">PutRequest:</span><span class="hl-1"> { </span><span class="hl-2">Item:</span><span class="hl-1"> { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;3&#39;</span><span class="hl-1"> }, </span><span class="hl-2">otherProperty:</span><span class="hl-1"> { </span><span class="hl-2">BOOL:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1"> } } } }],</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;2&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">    </span><span class="hl-7">// etc., continuing to count up to</span><br/><span class="hl-1">    [</span><span class="hl-3">&#39;tableName&#39;</span><span class="hl-1">, { </span><span class="hl-2">DeleteRequest:</span><span class="hl-1"> { </span><span class="hl-2">Key:</span><span class="hl-1"> { </span><span class="hl-2">keyProperty:</span><span class="hl-1"> { </span><span class="hl-2">N:</span><span class="hl-1"> </span><span class="hl-3">&#39;102&#39;</span><span class="hl-1"> } } } }]</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-0">for</span><span class="hl-1"> </span><span class="hl-0">await</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">item</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">BatchWrite</span><span class="hl-1">(</span><span class="hl-2">dynamoDb</span><span class="hl-1">, </span><span class="hl-2">keys</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">item</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>The above code snippet will automatically split the provided keys into <code>BatchWriteItem</code> requests of 25 or fewer write request objects, and any unprocessed request objects will be automatically retried until they are handled. The above code will execute at least 5 <code>BatchWriteItem</code> operations, dependening on how many items are returned without processing due to insufficient provisioned write capacity.</p>
<p>Each item yielded in the <code>for...await...of</code> loop will be a single write request that has succeeded. Iteration will stop once each request has been handled or an error has been encountered.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/BatchGet.html" class="tsd-kind-icon">Batch<wbr/>Get</a></li><li class="tsd-kind-class"><a href="classes/BatchWrite.html" class="tsd-kind-icon">Batch<wbr/>Write</a></li><li class="tsd-kind-interface"><a href="interfaces/BatchGetOptions.html" class="tsd-kind-icon">Batch<wbr/>Get<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/BatchState.html" class="tsd-kind-icon">Batch<wbr/>State</a></li><li class="tsd-kind-interface"><a href="interfaces/PerTableOptions.html" class="tsd-kind-icon">Per<wbr/>Table<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/TableOptions.html" class="tsd-kind-icon">Table<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/TableState.html" class="tsd-kind-icon">Table<wbr/>State</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/TableThrottlingTracker.html" class="tsd-kind-icon">Table<wbr/>Throttling<wbr/>Tracker</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/ThrottledTableConfiguration.html" class="tsd-kind-icon">Throttled<wbr/>Table<wbr/>Configuration</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#SyncOrAsyncIterable" class="tsd-kind-icon">Sync<wbr/>Or<wbr/>Async<wbr/>Iterable</a></li><li class="tsd-kind-type-alias"><a href="modules.html#TableStateElement" class="tsd-kind-icon">Table<wbr/>State<wbr/>Element</a></li><li class="tsd-kind-variable"><a href="modules.html#MAX_READ_BATCH_SIZE" class="tsd-kind-icon">MAX_<wbr/>READ_<wbr/>BATCH_<wbr/>SIZE</a></li><li class="tsd-kind-variable"><a href="modules.html#MAX_WRITE_BATCH_SIZE" class="tsd-kind-icon">MAX_<wbr/>WRITE_<wbr/>BATCH_<wbr/>SIZE</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>